<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fabric.js Canvas</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/4.5.0/fabric.min.js"></script>
</head>
<body>
    <canvas id="canvas" width="800" height="600"></canvas>
    <button onclick="download()">Download</button>

    <script>
        var canvas = new fabric.Canvas('canvas');
        var imageUrl = "{{ image_url }}";
        var textTopValue = "{{ text_top }}";
        var textBottomValue = "{{ text_bottom }}";
        var textColor = "{{ text_color }}";
        var rectColor = "{{ rect_color }}"; // Color for the text background box

        fabric.Image.fromURL(imageUrl, function(oImg) {
            canvas.add(oImg);
            addTextWithBackground(textTopValue, 20); // Top position
            addTextWithBackground(textBottomValue, canvas.height - 60); // Bottom position
        });

        function addTextWithBackground(textValue, topPosition) {
            var text = new fabric.Text(textValue, {
                fontSize: 20,
                fill: textColor,
                originX: 'left',
                originY: 'top'
            });

            var rect = new fabric.Rect({
                left: 10,
                top: topPosition,
                fill: rectColor,
                width: canvas.width - 20, // Full width of canvas
                height: 40,
                originX: 'left',
                originY: 'top'
            });

            var group = new fabric.Group([rect, text], {
                left: 10,
                top: topPosition
            });

            canvas.add(group);
        }

        function download() {
            var link = document.createElement('a');
            link.download = 'canvas.png';
            link.href = canvas.toDataURL('image/png').replace('image/png', 'image/octet-stream');
            link.click();
        }
    </script>
</body>
</html>
